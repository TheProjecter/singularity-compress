%% LyX 1.4.3 created this file.  For more info, see http://www.lyx.org/.
%% Do not edit unless you really know what you are doing.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% LyX specific LaTeX commands.
%% Bold symbol macro for standard LaTeX users
\providecommand{\boldsymbol}[1]{\mbox{\boldmath $#1$}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% User specified LaTeX commands.
%% This file was generated by tiny_c2l (version 1.4.0, 25-feb-2000)

\ifx\getformat\undefined
 \newcount\getformat\getformat0
\else
 \mfilestrue\getformat3
\fi
\ifx\undefined\advance\getformat1\fi

\ifcase\getformat
 
 \usepackage{a4}
\usepackage{position}
\usepackage{fancyhdr}

 
 \textwidth18cm\textheight25cm\hoffset-3cm\voffset-1cm
\or
 \documentstyle[a4,position,fancyhdr]{article}
 \textwidth18cm\textheight25cm\hoffset-3cm\voffset-1cm
\else\fi % multiple file input: don't load format

\plcntmargin{777}
\lhead{\headfont }
\chead{\headfont Produced from packer/simple{\ul}c.c on 16{\mm}Jan{\mm}2007 23:20}
\rhead{\headfont }
\lfoot{\footfont }
\cfoot{\footfont Page \thepage}
\rfoot{\footfont }
\plinenowidth0pt
\gdef\cmt#1#2{\psinit{#1}{\hphantom{/}$\ast$\mblank{#2}}\commentfont}
\gdef\cmtpp#1#2{\psinit{#1}{//\mblank{#2}}\commentfont}
\gdef\ccmtend{\setbox\pstartbox=\hbox{\hphantom{/}}}
\ifmfiles\else

\usepackage{babel}
\makeatother
\begin{document}
\fi

\begin{flushleft}\init0{}\njo0{}\cmtinit\njo0{/$\ast$ }\n
\initc{0}{5}{1}{}\cmt{0}{1}\njo0{Singularity{\mm}compress:}\njo{25}{arithmetic}\njo{36}{encoder
}\n \initc{0}{5}{0}{}\njo0{ }\n \initc{0}{5}{1}{}\njo0{Based}\njo{9}{on}\njo{12}{Michael}\njo{20}{Schindler{'}s}\njo{32}{rangecoder,}\njo{44}{which}\njo{50}{is:
}\n \initc{0}{5}{1}{}\njo0{(c)}\njo{7}{Michael}\njo{15}{Schindler}\njo{25}{1999
}\n \initc{0}{5}{1}{}\njo0{http://www.compressconsult.com/
}\n \initc{0}{5}{0}{}\njo0{ }\n \initc{0}{5}{1}{}\njo0{This}\njo{8}{program}\njo{16}{is}\njo{19}{free}\njo{24}{software;}\njo{34}{you}\njo{38}{can}\njo{42}{redistribute}\njo{55}{it}\njo{58}{and/or
}\n \initc{0}{5}{1}{}\njo0{modify}\njo{10}{it}\njo{13}{under}\njo{19}{the}\njo{23}{terms}\njo{29}{of}\njo{32}{the}\njo{36}{GNU}\njo{40}{General}\njo{48}{Public}\njo{55}{License
}\n \initc{0}{5}{1}{}\njo0{as}\njo{6}{published}\njo{16}{by}\njo{19}{the}\njo{23}{Free}\njo{28}{Software}\njo{37}{Foundation;}\njo{49}{version}\njo{57}{2
}\n \initc{0}{5}{1}{}\njo0{of}\njo{6}{the}\njo{10}{License.
}\n \initc{0}{0}{0}{}\njo0{ }\n \initc{0}{5}{1}{}\njo0{This}\njo{8}{program}\njo{16}{is}\njo{19}{distributed}\njo{31}{in}\njo{34}{the}\njo{38}{hope}\njo{43}{that}\njo{48}{it}\njo{51}{will}\njo{56}{be}\njo{59}{useful,
}\n \initc{0}{5}{1}{}\njo0{but}\njo{7}{WITHOUT}\njo{15}{ANY}\njo{19}{WARRANTY;}\njo{29}{without}\njo{37}{even}\njo{42}{the}\njo{46}{implied}\njo{54}{warranty}\njo{63}{of
}\n \initc{0}{5}{1}{}\njo0{MERCHANTABILITY}\njo{19}{or}\njo{22}{FITNESS}\njo{30}{FOR}\njo{34}{A}\njo{36}{PARTICULAR}\njo{47}{PURPOSE.}\jmpo{57}{See}\njo{61}{the
}\n \initc{0}{5}{1}{}\njo0{GNU}\njo{7}{General}\njo{15}{Public}\njo{22}{License}\njo{30}{for}\njo{34}{more}\njo{39}{details.
}\n \initc{0}{0}{0}{}\njo0{ }\n \initc{0}{5}{1}{}\njo0{You}\njo{7}{should}\njo{14}{have}\njo{19}{received}\njo{28}{a}\njo{30}{copy}\njo{35}{of}\njo{38}{the}\njo{42}{GNU}\njo{46}{General}\njo{54}{Public}\njo{61}{License
}\n \initc{0}{5}{1}{}\njo0{along}\njo{9}{with}\njo{14}{this}\njo{19}{program;}\njo{28}{if}\njo{31}{not,}\njo{36}{write}\njo{42}{to}\njo{45}{the}\njo{49}{Free}\njo{54}{Software
}\n \initc{0}{5}{1}{}\njo0{Foundation,}\njo{15}{Inc.,}\njo{21}{51}\njo{24}{Franklin}\njo{33}{Street,}\njo{41}{Fifth}\njo{47}{Floor,}\njo{54}{Boston,}\njo{62}{MA}\jmpo{66}{02110{\mm}1301,}\njo{78}{USA.
}\n \initc{0}{5}{0}{}\ccmtend\basefont\njo0{/}\njo0{
}\n\ped \init0{}\njo0{ }\n\ped \init0{}\njo0{{\keywordfont
\#}}\pes{ \bs{1}}{3}\njo0{{\keywordfont include}}\njo{9}{$<$stdio.h$>$
}\n\ped \init0{}\njo0{{\keywordfont \#}}\pes{ \bs{1}}{3}\njo0{{\keywordfont
include}}\njo{9}{$<$stdlib.h$>$ }\n\ped \init0{}\njo0{
}\n\ped \init0{}\njo0{{\keywordfont \#}}\pes{ \bs{1}}{3}\njo0{{\keywordfont
ifndef}}\njo{8}{unix }\n\ped \init0{}\njo0{{\keywordfont
\#}}\pes{ \bs{1}}{3}\njo0{{\keywordfont include}}\njo{9}{$<$fcntl.h$>$
}\n\ped \init0{}\njo0{\#endif }\n\ped \init0{}\njo0{
}\n\ped \init0{}\njo0{{\keywordfont \#}}\pes{ \bs{1}}{3}\njo0{{\keywordfont
include}}\njo{9}{$<$ctype.h$>$ }\n\ped \init0{}\njo0{{\keywordfont
\#}}\pes{ \bs{1}}{3}\njo0{{\keywordfont include}}\njo{9}{$<$stdint.h$>$
}\n\ped \init0{}\njo0{{\keywordfont \#}}\pes{ \bs{1}}{3}\njo0{{\keywordfont
include}}\njo{9}{$<$string.h$>$ }\n\ped \init0{}\njo0{
}\n\ped \init0{}\njo0{{\keywordfont \#}}\pes{ \bs{1}}{3}\njo0{{\keywordfont
include}}\njo{9}{\qql}\stringfont\pes{\bs{1}}{0}\njo0{range{\ul}encoder.h\basefont
\qqr}\basefont\pes{ \bs{1}}{3}\njo0{}\n\ped \init0{}\njo0{
}\n\ped \init0{}\njo0{{\keywordfont \#}}\pes{ \bs{1}}{3}\njo0{{\keywordfont
include}}\njo{9}{\qql}\stringfont\pes{\bs{1}}{0}\njo0{lz{\ul}coder.h\basefont
\qqr}\basefont\pes{ \bs{1}}{3}\njo0{}\n\ped \init0{}\njo0{{\keywordfont
\#}}\pes{ \bs{1}}{3}\njo0{{\keywordfont include}}\njo{9}{\qql}\stringfont\pes{\bs{1}}{0}\njo0{../common/code{\ul}tables.h\basefont
\qqr}\basefont\pes{ \bs{1}}{3}\njo0{}\n\ped \init0{}\njo0{{\keywordfont
\#}}\pes{ \bs{1}}{3}\njo0{{\keywordfont include}}\njo{9}{\qql}\stringfont\pes{\bs{1}}{0}\njo0{codes.h\basefont
\qqr}\basefont\pes{ \bs{1}}{3}\njo0{}\n\ped \init0{}\njo0{{\keywordfont
\#}}\pes{ \bs{1}}{3}\njo0{{\keywordfont include}}\njo{9}{\qql}\stringfont\pes{\bs{1}}{0}\njo0{../common/model.h\basefont
\qqr}\basefont\pes{ \bs{1}}{3}\njo0{}\n\ped \init0{}\njo0{
}\n\ped \init0{}\njo0{}\cmtinit\njo0{/$\ast$ }\n \initc{0}{5}{1}{}\cmt{0}{1}\njo0{Symbols:}\njo{12}{
}\n \initc{0}{5}{1}{}\njo0{0{\mm}255:}\njo{10}{literal
}\n \initc{0}{5}{1}{}\njo0{256{\mm}288:}\njo{12}{match}\njo{18}{length:}\njo{26}{3{\mm}
}\n \initc{0}{5}{0}{}\njo0{ }\n \initc{0}{5}{0}{}\ccmtend\basefont\njo0{/}\njo0{
}\n\ped \init0{}\njo0{ }\n\ped \init0{}\njo0{ }\n\ped
\init0{}\njo0{{\keywordfont struct}}\njo{7}{lz{\ul}extra{\ul}data}\njo{21}{}\njo0{\brl{}
}\n\ped \init{3}{}\njo{-3}{uint8{\ul}t}\jmpo{13}{extra{\ul}bits;}\njo0{
}\n\ped \init{3}{}\njo{-3}{size{\ul}t}\jmpo{13}{extra{\ul}data;}\njo0{
}\n\ped \init{3}{}\njo{-3}{uint16{\ul}t}\jmpo{13}{distance;}\njo0{
}\n\ped \init0{}\njo0{\brr{}}\njo0{;}\njo0{ }\n\ped
\init0{}\njo0{ }\n\ped \init0{}\njo0{ }\n\ped \init0{}\njo0{{\keywordfont
static}}\njo{7}{{\keywordfont void}}\njo{12}{usage({\keywordfont
void}) }\n\ped \init0{}\njo0{}\njo0{\brl{}}\jmpo{4}{
}\n\ped \init{3}{}\njo{-3}{fprintf(stderr,}\njo0{\qql}\stringfont\pes{\bs{1}}{0}\njo0{simple{\ul}c~}\njo0{{[}inputfile~}\njo0{{[}outputfile]]\bs{1}n}\njo0{\basefont
\qqr}\basefont\ped\pstart\pstarta\njo0{);}\njo0{ }\n\ped
\init{3}{}\njo{-3}{exit(1);}\njo0{ }\n\ped \init0{}\njo0{\brr{}}\njo0{
}\n\ped \init0{}\njo0{ }\n\ped \init0{}\njo0{{\keywordfont
static}}\njo{7}{{\keywordfont int}}\njo{11}{errcnt}\njo0{=0;}\njo0{
}\n\ped \init0{}\njo0{{\keywordfont static}}\njo{7}{{\keywordfont
int}}\njo{11}{check{\ul}lz({\keywordfont const}}\njo{26}{{\keywordfont
struct}}\njo{33}{lz{\ul}buffer}\njo0{$\ast$}\njo{44}{lz{\ul}buff,}\njo0{ssize{\ul}t}\njo{60}{length,}\njo0{ssize{\ul}t}\njo{75}{distance)
}\n\ped \init0{}\njo0{}\njo0{\brl{} }\n\ped \init{3}{}\njo{-3}{ssize{\ul}t}\njo{11}{i;}\njo0{
}\n\ped \init{3}{}\njo{-3}{{\keywordfont for}(i}\njo0{=0;}\njo0{i$<$length;}\njo0{i++)
}\n\ped \init{6}{}\njo{-6}{{\keywordfont if}(lz{\ul}buff}\njo0{{\mm}$>$buffer{[}}\njo{26}{WRAP{\ul}BUFFER{\ul}INDEX(lz{\ul}buff,}\njo{53}{lz{\ul}buff}\njo0{{\mm}$>$offset}\njo{69}{}\njo0{{\mm}}\njo{71}{distance}\njo{80}{}\njo0{+}\njo{82}{i)}\njo{85}{]}\njo{87}{}\njo0{!=}\njo{90}{
}\n\ped \init{12}{}\njo{-12}{lz{\ul}buff}\njo0{{\mm}$>$buffer{[}}\njo{29}{WRAP{\ul}BUFFER{\ul}INDEX(lz{\ul}buff,}\njo{56}{lz{\ul}buff}\njo0{{\mm}$>$offset}\njo{72}{}\njo0{+}\njo{74}{i)}\njo{77}{]}\njo{79}{)}\njo{81}{}\njo0{\brl{}
}\n\ped \init{9}{}\njo{-9}{errcnt++;}\njo0{ }\n\ped
\init{9}{}\njo{-9}{{\keywordfont return}}\njo{16}{0;}\njo0{
}\n\ped \init{6}{}\njo{-6}{\brr{}}\njo0{ }\n\ped
\init{3}{}\njo{-3}{{\keywordfont return}}\njo{10}{1;}\njo0{
}\n\ped \init0{}\njo0{\brr{}}\njo0{ }\n\ped \init0{}\njo0{
}\n\ped \init0{}\njo0{ }\n\ped \init0{}\njo0{{\keywordfont
static}}\njo{7}{size{\ul}t}\njo{14}{lz{\ul}encode{\ul}buffer({\keywordfont
struct}}\njo{38}{lz{\ul}buffer}\njo0{$\ast$}\njo{49}{lz{\ul}buff,}\njo0{{\keywordfont
struct}}\njo{64}{lz{\ul}extra{\ul}data}\njo0{$\ast$}\njo{79}{extra{\ul}datas,}\njo0{uint16{\ul}t}\njo0{$\ast$}\njo{101}{lz{\ul}out{\ul}buffer,}\njo{116}{size{\ul}t}\njo0{$\ast$}\njo{124}{len)
}\n\ped \init0{}\njo0{}\njo0{\brl{} }\n\ped \init{3}{}\njo{-3}{ssize{\ul}t}\njo{11}{distance;}\njo0{
}\n\ped \init{3}{}\njo{-3}{ssize{\ul}t}\njo{11}{length;}\njo0{
}\n\ped \init{3}{}\njo{-3}{size{\ul}t}\njo{10}{i;}\njo0{
}\n\ped \init{3}{}\njo{-3}{uint8{\ul}t}\njo{11}{last}\njo0{=0;}\njo0{
}\n\ped \init{3}{}\njo{-3}{size{\ul}t}\njo{10}{extra{\ul}datas{\ul}cnt}\njo{26}{}\njo0{=}\njo{28}{0;}\njo0{
}\n\ped \init0{}\njo0{ }\n\ped \init0{}\njo0{ }\n\ped
\init0{}\njo0{}\cmtinit\njo0{/$\ast$}\cmt{0}{0}\jmpo{3}{for(i=0;i$<$$\ast$len;i++)
}\n \initc{6}{0}{0}{}\njo0{lz{\ul}out{\ul}buffer{[}i]}\njo{23}{=}\njo{25}{lz{\ul}buff{\mm}$>$buffer{[}WRAP{\ul}BUFFER{\ul}INDEX(lz{\ul}buff,}\njo{68}{lz{\ul}buff{\mm}$>$offset+i)];
}\n \initc{3}{0}{0}{}\njo0{return}\njo{10}{0;}\ccmtend\basefont\njo0{\mast{1}/}\njo0{
}\n\ped \init{3}{}\njo{-3}{{\keywordfont for}(i}\njo0{=0;}\njo0{i}\njo{13}{$<$}\njo{15}{}\njo0{$\ast$len;}\njo{21}{i++)}\njo{26}{}\njo0{\brl{}}\n\ped
\init{6}{}\njo{-6}{{\keywordfont const}}\njo{12}{{\keywordfont
char}}\njo{17}{c}\njo{19}{}\njo0{=}\njo{21}{lz{\ul}buff}\njo0{{\mm}$>$buffer{[}WRAP{\ul}BUFFER{\ul}INDEX(lz{\ul}buff,}\njo{64}{lz{\ul}buff}\njo0{{\mm}$>$offset)];}\njo0{
}\n\ped \init{6}{}\njo{-6}{lzbuff{\ul}search{\ul}longest{\ul}match(lz{\ul}buff,}\njo{43}{lz{\ul}buff}\njo0{{\mm}$>$offset,}\njo{60}{lz{\ul}buff}\njo0{{\mm}$>$buffer{\ul}len}\njo0{/2,}\njo{83}{\&distance,}\njo{94}{\&length);}\njo0{
}\n\ped \init0{}\njo0{ }\n\ped \init{6}{}\njo{-6}{}\cmtinit\njo0{/$\ast$show{\ul}match(lz{\ul}buff,distance,length);}\ccmtend\basefont\njo0{\mast{1}/}\njo0{
}\n\ped \init0{}\njo0{ }\n\ped \init0{}\njo0{ }\n\ped
\init{6}{}\njo{-6}{}\cmtinit\njo0{/$\ast$show{\ul}lz{\ul}buff(lz{\ul}buff);}\ccmtend\basefont\njo0{\mast{1}/}\njo0{
}\n\ped \init0{}\njo0{ }\n\ped \init0{}\njo0{ }\n\ped
\init{6}{}\njo{-6}{{\keywordfont if}(length}\njo{16}{}\njo0{$>$=}\njo{19}{code{\ul}to{\ul}length{[}0].start}\njo{43}{}\njo0{\&\&}\njo{46}{distance}\njo{55}{$>$0}\njo{58}{}\njo0{\&\&}\njo{61}{distance}\njo{70}{$<$}\njo{72}{lz{\ul}buff}\njo0{{\mm}$>$buffer{\ul}len}\njo0{/2}\njo{94}{}\njo0{\&\&}\njo{97}{check{\ul}lz(lz{\ul}buff,}\njo0{length,}\njo0{distance)}\njo{131}{)}\njo{133}{}\njo0{\brl{}}\n\ped
\init{9}{}\njo{-9}{{\keywordfont struct}}\njo{16}{lz{\ul}extra{\ul}data}\njo0{$\ast$}\njo{31}{extra{\ul}data}\njo{42}{}\njo0{=}\njo{44}{\&extra{\ul}datas{[}extra{\ul}datas{\ul}cnt++];}\njo0{
}\n\ped \init0{}\njo0{ }\n\ped \init0{}\njo0{ }\n\ped
\init{9}{}\njo{-9}{extra{\ul}data}\njo0{{\mm}$>$distance}\njo{30}{}\njo0{=}\njo{32}{distance;}\njo0{
}\n\ped \init0{}\njo0{ }\n\ped \init{9}{}\njo{-9}{lz{\ul}out{\ul}buffer{[}i]}\njo{26}{}\njo0{=}\njo{28}{0x100}\njo{34}{}\njo0{+}\njo{36}{length{\ul}to{\ul}code(length,}\njo{59}{\&extra{\ul}data}\njo0{{\mm}$>$extra{\ul}bits,}\njo{84}{\&extra{\ul}data}\njo0{{\mm}$>$extra{\ul}data);}\njo0{
}\n\ped \init{9}{}\njo{-9}{lz{\ul}buff}\njo0{{\mm}$>$offset}\njo{25}{}\njo0{=}\njo{27}{WRAP{\ul}BUFFER{\ul}INDEX(lz{\ul}buff,}\njo{54}{lz{\ul}buff}\njo0{{\mm}$>$offset}\njo{70}{}\njo0{+}\njo{72}{length);}\njo0{
}\n\ped \init{9}{}\njo{-9}{}\njo0{$\ast$len}\njo{14}{}\njo0{{\mm}=}\njo{17}{length}\njo0{{\mm}1;}\njo0{
}\n\ped \init{6}{}\njo{-6}{\brr{}}\njo0{ }\n\ped
\init{6}{}\njo{-6}{{\keywordfont else}}\njo{11}{}\njo0{\brl{}}\n\ped
\init{9}{}\njo{-9}{lzbuff{\ul}insert(lz{\ul}buff,}\njo{32}{c);}\njo0{
}\n\ped \init{9}{}\njo{-9}{lz{\ul}out{\ul}buffer{[}i]}\njo{26}{}\njo0{=}\njo{28}{c;}\njo0{
}\n\ped \init{6}{}\njo{-6}{\brr{}}\njo0{ }\n\ped
\init{3}{}\njo{-3}{\brr{}}\njo0{ }\n\ped \init{3}{}\njo{-3}{
}\n\ped \init{3}{}\njo{-3}{{\keywordfont for}(i}\njo0{=0;}\njo0{i$<$lz{\ul}buff}\njo0{{\mm}$>$buffer{\ul}len}\njo0{/2;}\njo0{i++)
}\n\ped \init{6}{}\njo{-6}{lz{\ul}remove(lz{\ul}buff,}\njo{25}{lz{\ul}buff}\njo0{{\mm}$>$offset}\njo0{+lz{\ul}buff}\njo0{{\mm}$>$buffer{\ul}len}\njo0{/2}\njo0{+i);}\njo0{
}\n\ped \init{3}{}\njo{-3}{{\keywordfont return}}\njo{10}{extra{\ul}datas{\ul}cnt;}\njo0{
}\n\ped \init0{}\njo0{\brr{}}\njo0{ }\n\ped \init0{}\njo0{
}\n\ped \init0{}\njo0{}\cmtinit\njo0{/$\ast$\commentfont~count}\cmt{0}{1}\njo{9}{number}\njo{16}{of}\njo{19}{occurances}\njo{30}{of}\njo{33}{each}\njo{38}{byte}\njo{43}{}\ccmtend\basefont\njo0{\mast{1}/}\njo0{
}\n\ped \init0{}\njo0{{\keywordfont static}}\njo{7}{{\keywordfont
void}}\njo{12}{countblock(uint16{\ul}t}\njo{32}{}\njo0{$\ast$buffer,}\njo{41}{freq}\njo{46}{length,}\njo{54}{freq}\njo{59}{}\njo0{$\ast$counters)
}\n\ped \init0{}\njo0{}\njo0{\brl{}}\jmpo{4}{ }\n\ped
\init{4}{}\njo{-4}{size{\ul}t}\njo{11}{i;}\njo0{
}\n\ped \init{4}{}\njo{-4}{}\cmtinit\njo0{/$\ast$\commentfont~zero}\cmt{4}{1}\njo{12}{counters}\njo{21}{}\ccmtend\basefont\njo0{\mast{1}/}\njo0{
}\n\ped \init{4}{}\njo{-4}{memset(counters,}\njo{21}{0}\njo{23}{,}\njo0{{\keywordfont
sizeof}(counters{[}0])}\njo0{$\ast$(SYMBOLS}\njo0{+1));}\njo0{
}\n\ped \init{4}{}\njo{-4}{}\cmtinit\njo0{/$\ast$\commentfont~then}\cmt{4}{1}\njo{12}{count}\njo{18}{the}\njo{22}{number}\njo{29}{of}\njo{32}{occurances}\njo{43}{of}\njo{46}{each}\njo{51}{byte}\njo{56}{}\ccmtend\basefont\njo0{\mast{1}/}\njo0{
}\n\ped \init{4}{}\njo{-4}{{\keywordfont for}}\njo{8}{(i}\njo0{=0;}\njo{14}{i$<$length;}\njo{24}{i++)
}\n\ped \init{7}{}\njo{-7}{counters{[}buffer{[}i]]++;}\njo0{
}\n\ped \init0{}\njo0{\brr{}}\njo0{ }\n\ped \init0{}\njo0{{\keywordfont
\#}}\pes{ \bs{1}}{3}\njo0{{\keywordfont define}}\njo{8}{MIN(a,}\njo0{b)}\njo{17}{((a)$<$(b)?(a):(b))
}\n\ped \init0{}\njo0{{\keywordfont int}}\njo{4}{main(}\njo{10}{{\keywordfont
int}}\njo{14}{argc,}\njo{20}{{\keywordfont char}}\njo{25}{}\njo0{$\ast$argv{[}]}\njo{33}{)
}\n\ped \init0{}\njo0{}\njo0{\brl{}}\jmpo{4}{ }\n\ped
\init{3}{}\njo{-3}{size{\ul}t}\njo{10}{blocksize;}\njo0{
}\n\ped \init{3}{}\njo{-3}{rangecoder}\njo{14}{rc;}\njo0{
}\n\ped \init{3}{}\njo{-3}{unsigned}\njo{12}{{\keywordfont
char}}\njo{17}{buffer{[}BLOCKSIZE];}\njo0{ }\n\ped \init{3}{}\njo{-3}{uint16{\ul}t}\njo{12}{lz{\ul}out{\ul}buffer{[}BLOCKSIZE];}\njo0{
}\n\ped \init{3}{}\njo{-3}{{\keywordfont struct}}\njo{10}{lz{\ul}extra{\ul}data}\njo{24}{extra{\ul}datas{[}BLOCKSIZE];}\njo0{
}\n\ped \init{3}{}\njo{-3}{size{\ul}t}\njo{10}{extra{\ul}data{\ul}cnt}\njo{25}{}\njo0{=}\njo{27}{0;}\njo0{
}\n\ped \init{3}{}\njo{-3}{size{\ul}t}\njo{10}{j;}\njo0{
}\n\ped \init{3}{}\njo{-3}{{\keywordfont struct}}\njo{10}{lz{\ul}buffer}\njo{20}{lz{\ul}buff;}\njo0{
}\n\ped \init{3}{}\njo{-3}{{\keywordfont struct}}\njo{10}{ari{\ul}model}\njo{20}{model;}\njo0{
}\n\ped \init{3}{}\njo{-3}{size{\ul}t}\njo{10}{processed}\njo{20}{}\njo0{=}\njo{22}{0;}\njo0{
}\n\ped \init0{}\njo0{ }\n\ped \init{3}{}\njo{-3}{{\keywordfont
if}}\njo{6}{((argc}\njo{13}{$>$}\njo{15}{3)}\njo{18}{}\njo0{$\mid$$\mid$}\njo{21}{((argc$>$1)}\njo{31}{}\njo0{\&\&}\njo{34}{(argv{[}1]{[}0]}\njo0{=={\sq}{\mm}{\sq})))
}\n\ped \init{6}{}\njo{-6}{usage();}\njo0{ }\n\ped
\init0{}\njo0{ }\n\ped \init{3}{}\njo{-3}{{\keywordfont
if}}\njo{6}{(}\njo{8}{argc}\njo{13}{}\njo0{$<$=}\njo{16}{1}\njo{18}{)
}\n\ped \init{6}{}\njo{-6}{fprintf(}\njo{15}{stderr,}\njo{23}{\qql}\stringfont\pes{\bs{1}}{0}\njo0{stdin\basefont
\qqr}\basefont\ped\pstart\pstarta\njo0{}\njo{31}{);}\njo0{
}\n\ped \init{3}{}\njo{-3}{{\keywordfont else}}\njo{8}{}\njo0{\brl{}}\n\ped
\init{6}{}\njo{-6}{freopen(}\njo{15}{argv{[}1],}\njo{24}{\qql}\stringfont\pes{\bs{1}}{0}\njo0{rb\basefont
\qqr}\basefont\ped\pstart\pstarta\njo0{,}\njo{30}{stdin}\njo{36}{);}\njo0{
}\n\ped \init{6}{}\njo{-6}{fprintf(}\njo{15}{stderr,}\njo{23}{\qql}\stringfont\pes{\bs{1}}{0}\njo0{\%s\basefont
\qqr}\basefont\ped\pstart\pstarta\njo0{,}\njo{29}{argv{[}1]}\njo{37}{);}\njo0{
}\n\ped \init{3}{}\njo{-3}{\brr{}}\njo0{ }\n\ped
\init{3}{}\njo{-3}{{\keywordfont if}}\njo{6}{(}\njo{8}{argc}\njo{13}{}\njo0{$<$=}\njo{16}{2}\njo{18}{)
}\n\ped \init{6}{}\njo{-6}{fprintf(}\njo{15}{stderr,}\njo{23}{\qql}\stringfont\pes{\bs{1}}{0}\njo0{~}\njo0{to~}\njo0{stdout\bs{1}n}\njo0{\basefont
\qqr}\basefont\ped\pstart\pstarta\njo0{}\njo{38}{);}\njo0{
}\n\ped \init{3}{}\njo{-3}{{\keywordfont else}}\njo{8}{}\njo0{\brl{}}\n\ped
\init{6}{}\njo{-6}{freopen(}\njo{15}{argv{[}2],}\njo{24}{\qql}\stringfont\pes{\bs{1}}{0}\njo0{wb\basefont
\qqr}\basefont\ped\pstart\pstarta\njo0{,}\njo{30}{stdout}\njo{37}{);}\njo0{
}\n\ped \init{6}{}\njo{-6}{fprintf(}\njo{15}{stderr,}\njo{23}{\qql}\stringfont\pes{\bs{1}}{0}\njo0{~}\njo0{to~}\njo0{\%s\bs{1}n}\njo0{\basefont
\qqr}\basefont\ped\pstart\pstarta\njo0{,}\njo{35}{argv{[}2]}\njo{43}{);}\njo0{
}\n\ped \init{3}{}\njo{-3}{\brr{}}\njo0{ }\n\ped
\init0{}\njo0{ }\n\ped \init0{}\njo0{{\keywordfont \#}}\pes{
\bs{1}}{3}\njo0{{\keywordfont ifndef}}\njo{8}{unix
}\n\ped \init{3}{}\njo{-3}{setmode(}\njo{12}{fileno(}\njo{20}{stdin}\njo{26}{),}\njo{29}{O{\ul}BINARY}\njo{38}{);}\njo0{
}\n\ped \init{3}{}\njo{-3}{setmode(}\njo{12}{fileno(}\njo{20}{stdout}\njo{27}{),}\njo{30}{O{\ul}BINARY}\njo{39}{);}\njo0{
}\n\ped \init0{}\njo0{\#endif }\n\ped \init0{}\njo0{
}\n\ped \init{3}{}\njo{-3}{}\cmtinit\njo0{/$\ast$\commentfont~initialize}\cmt{3}{1}\njo{17}{the}\njo{21}{range}\njo{27}{coder,}\njo{34}{first}\njo{40}{byte}\njo{45}{0,}\njo{48}{no}\njo{51}{header}\njo{58}{}\ccmtend\basefont\njo0{\mast{1}/}\njo0{
}\n\ped \init{3}{}\njo{-3}{start{\ul}encoding(\&rc,}\njo0{0,}\njo0{0);}\njo0{
}\n\ped \init{3}{}\njo{-3}{setup{\ul}lz{\ul}buffer(\&lz{\ul}buff,}\njo{29}{1}\njo0{+BLOCKSIZE{\ul}POWER);}\njo0{
}\n\ped \init{3}{}\njo{-3}{model{\ul}setup(\&model);}\njo0{
}\n\ped \init0{}\njo0{ }\n\ped \init{3}{}\njo{-3}{{\keywordfont
while}}\njo{9}{(1) }\n\ped \init{3}{}\njo{-3}{}\njo0{\brl{}}\jmpo{7}{
}\n\ped \init{6}{}\njo{-6}{freq}\njo{11}{i;}\njo0{
}\n\ped \init{6}{}\njo{-6}{size{\ul}t}\njo{13}{extra{\ul}datas{\ul}cnt;}\njo0{
}\n\ped \init{6}{}\njo{-6}{ }\n\ped \init{6}{}\njo{-6}{blocksize}\njo{16}{}\njo0{=}\njo{18}{MIN(}\njo{23}{BLOCKSIZE,}\njo{34}{lz{\ul}buff.buffer{\ul}len}\njo{53}{}\njo0{{\mm}}\njo{55}{lz{\ul}buff.offset);}\njo0{
}\n\ped \init{6}{}\njo{-6}{}\cmtinit\njo0{/$\ast$\commentfont~get}\cmt{6}{1}\njo{13}{the}\njo{17}{statistics}\njo{28}{}\ccmtend\basefont\njo0{\mast{1}/}\njo0{
}\n\ped \init{6}{}\njo{-6}{blocksize}\njo{16}{}\njo0{=}\njo{18}{fread(lz{\ul}buff.buffer}\njo0{+lz{\ul}buff.offset,}\njo0{1,}\njo0{(size{\ul}t)blocksize,}\njo0{stdin);}\njo0{
}\n\ped \init0{}\njo0{ }\n\ped \init{6}{}\njo{-6}{}\cmtinit\njo0{/$\ast$\commentfont~terminate}\cmt{6}{1}\njo{19}{if}\njo{22}{no}\njo{25}{more}\njo{30}{data}\njo{35}{}\ccmtend\basefont\njo0{\mast{1}/}\njo0{
}\n\ped \init{6}{}\njo{-6}{{\keywordfont if}}\njo{9}{(blocksize}\njo0{==0)}\njo{24}{{\keywordfont
break};}\njo0{ }\n\ped \init0{}\njo0{ }\n\ped \init{6}{}\njo{-6}{encode{\ul}freq(\&rc,}\njo0{1,}\njo0{1,}\njo0{2);}\njo{30}{}\cmtinit\njo0{/$\ast$\commentfont~a}\cmt{30}{1}\njo{35}{stupid}\njo{42}{way}\njo{46}{to}\njo{49}{code}\njo{54}{a}\njo{56}{bit}\njo{60}{}\ccmtend\basefont\njo0{\mast{1}/}\njo0{
}\n\ped \init{6}{}\njo{-6}{}\cmtinit\njo0{/$\ast$\commentfont~blocksize,}\cmt{6}{1}\njo{20}{can}\njo{24}{be}\njo{27}{max}\njo{31}{2$\hat{~}$22,}\njo{37}{since}\njo{43}{we}\njo{46}{would}\njo{52}{need}\njo{57}{to}\njo{60}{restart}\njo{68}{coder}\njo{74}{anyway}\njo{81}{on}\njo{84}{$<$2$\hat{~}$23}\ccmtend\basefont\njo0{\mast{1}/}\njo0{
}\n\ped \init{6}{}\njo{-6}{extra{\ul}datas{\ul}cnt}\njo{22}{}\njo0{=}\njo{24}{lz{\ul}encode{\ul}buffer(\&lz{\ul}buff,}\njo0{extra{\ul}datas,}\njo0{lz{\ul}out{\ul}buffer,}\njo0{\&blocksize);}\njo0{
}\n\ped \init0{}\njo0{ }\n\ped \init{6}{}\njo{-6}{encode{\ul}short(\&rc,}\njo{24}{blocksize\&0xffff);}\njo0{
}\n\ped \init{6}{}\njo{-6}{encode{\ul}short(\&rc,}\njo{24}{blocksize\mgt{2}16);}\njo0{
}\n\ped \init{6}{}\njo{-6}{}\cmtinit\njo0{/$\ast$countblock(lz{\ul}out{\ul}buffer,blocksize,counts);}\ccmtend\basefont\njo0{\mast{1}/}\njo0{
}\n\ped \init0{}\njo0{ }\n\ped \init{6}{}\njo{-6}{}\cmtinit\njo0{/$\ast$\commentfont~write}\cmt{6}{1}\njo{15}{the}\njo{19}{statistics.}\njo{31}{}\ccmtend\basefont\njo0{\mast{1}/}\njo0{
}\n\ped \init{6}{}\njo{-6}{}\cmtinit\njo0{/$\ast$\commentfont~Cant}\cmt{6}{1}\njo{14}{use}\njo{18}{putchar}\njo{26}{or}\njo{29}{other}\njo{35}{since}\njo{41}{we}\njo{44}{are}\njo{48}{after}\njo{54}{start}\njo{60}{of}\njo{63}{the}\njo{67}{rangecoder}\njo{78}{}\ccmtend\basefont\njo0{\mast{1}/}\njo0{
}\n\ped \init{6}{}\njo{-6}{}\cmtinit\njo0{/$\ast$\commentfont~as}\cmt{6}{1}\njo{12}{you}\njo{16}{can}\njo{20}{see}\njo{24}{the}\njo{28}{rangecoder}\njo{39}{doesn{'}t}\njo{47}{care}\njo{52}{where}\njo{58}{probabilities}\njo{72}{come}\njo{77}{}\ccmtend\basefont\njo0{\mast{1}/}\njo0{
}\n\ped \init{6}{}\njo{-6}{}\cmtinit\njo0{/$\ast$\commentfont~from,}\cmt{6}{1}\njo{15}{it}\njo{18}{uses}\njo{23}{a}\njo{25}{flat}\njo{30}{distribution}\njo{43}{of}\njo{46}{0..0xffff}\njo{56}{in}\njo{59}{encode{\ul}short.}\njo{73}{}\ccmtend\basefont\njo0{\mast{1}/}\njo0{
}\n\ped \init0{}\njo0{ }\n\ped \init{6}{}\njo{-6}{}\cmtinit\njo0{/$\ast$fprintf(stderr,\texttt{\char`\"{}}Counters:\bs{1}n\texttt{\char`\"{}});
}\n \initc{8}{0}{0}{}\cmt{6}{0}\njo0{for(i=0;i$<$SYMBOLS;i++)}\njo{31}{\brl{}
}\n \initc{8}{0}{0}{}\njo0{fprintf(stderr,\texttt{\char`\"{}}\%d:\%ld\bs{1}n\texttt{\char`\"{}},i,counts{[}i]);
}\n \initc{8}{0}{0}{}\njo0{\brr{} }\n \initc{8}{0}{0}{}\njo0{fprintf(stderr,\texttt{\char`\"{}}\bs{1}n\texttt{\char`\"{}});}\ccmtend\basefont\njo0{\mast{1}/}\njo0{
}\n\ped \init0{}\njo0{ }\n\ped \init{6}{}\njo{-6}{}\cmtinit\njo0{/$\ast$for(i=0;}\cmt{6}{0}\njo{17}{i}\njo{19}{$<$}\njo{21}{SYMBOLS;}\njo{30}{i++)
}\n \initc{9}{0}{0}{}\njo0{encode{\ul}short(\&rc,counts{[}i]);}\ccmtend\basefont\njo0{\mast{1}/}\njo0{
}\n\ped \init0{}\njo0{ }\n\ped \init{6}{}\njo{-6}{}\cmtinit\njo0{/$\ast$\commentfont~store}\cmt{6}{1}\njo{15}{in}\njo{18}{counters{[}i]}\njo{30}{the}\njo{34}{number}\njo{41}{of}\njo{44}{all}\njo{48}{bytes}\njo{54}{$<$}\njo{56}{i,}\njo{59}{so}\njo{62}{sum}\njo{66}{up}\njo{69}{}\ccmtend\basefont\njo0{\mast{1}/}\njo0{
}\n\ped \init{6}{}\njo{-6}{}\cmtinit\njo0{/$\ast$counts{[}SYMBOLS]}\cmt{6}{0}\njo{24}{=}\njo{26}{blocksize;
}\n \initc{6}{0}{0}{}\njo0{for}\njo{10}{(i=SYMBOLS;}\njo{22}{i;}\njo{25}{i{\mm}{\mm})
}\n \initc{9}{0}{0}{}\njo0{counts{[}i{\mm}1]}\njo{21}{=}\njo{23}{counts{[}i]{\mm}counts{[}i{\mm}1];
}\n \initc{0}{5}{0}{}\ccmtend\basefont\njo0{/}\njo0{
}\n\ped \init0{}\njo0{ }\n\ped \init0{}\njo0{ }\n\ped
\init0{}\njo0{ }\n\ped \init{6}{}\njo{-6}{}\cmtinit\njo0{/$\ast$
}\n \initc{9}{0}{0}{}\cmt{6}{0}\njo0{fprintf(stderr,\texttt{\char`\"{}}Counters:\bs{1}n\texttt{\char`\"{}});
}\n \initc{9}{0}{0}{}\njo0{for(i=0;i$<$SYMBOLS;i++)}\njo{32}{\brl{}
}\n \initc{9}{0}{0}{}\njo0{fprintf(stderr,\texttt{\char`\"{}}C\%d:\%ld\bs{1}n\texttt{\char`\"{}},i,counts{[}i]);
}\n \initc{9}{0}{0}{}\njo0{\brr{} }\n \initc{9}{0}{0}{}\njo0{fprintf(stderr,\texttt{\char`\"{}}\bs{1}n\texttt{\char`\"{}});
}\n \initc{0}{5}{0}{}\ccmtend\basefont\njo0{/}\njo0{
}\n\ped \init0{}\njo0{ }\n\ped \init{6}{}\njo{-6}{}\cmtinit\njo0{/$\ast$\commentfont~output}\cmt{6}{1}\njo{16}{the}\njo{20}{encoded}\njo{28}{symbols}\njo{36}{}\ccmtend\basefont\njo0{\mast{1}/}\njo0{
}\n\ped \init{6}{}\njo{-6}{{\keywordfont for}(i}\njo0{=0,}\njo0{j}\njo0{=0;}\njo{19}{i$<$blocksize;}\njo{32}{i++)}\njo{37}{}\njo0{\brl{}}\n\ped
\init{9}{}\njo{-9}{freq}\njo{14}{cur{\ul}freq,}\njo{24}{cum{\ul}freq,}\njo{34}{total{\ul}freq;}\njo0{
}\n\ped \init{9}{}\njo{-9}{{\keywordfont const}}\njo{15}{uint16{\ul}t}\njo{24}{ch}\njo{27}{}\njo0{=}\njo{29}{lz{\ul}out{\ul}buffer{[}i];}\njo0{
}\n\ped \init{9}{}\njo{-9}{}\cmtinit\njo0{/$\ast$fprintf(stderr,\texttt{\char`\"{}}Encoding:\%d,(\%c),\%ld,\%ld\bs{1}n\texttt{\char`\"{}},ch,ch,counts{[}ch+1]{\mm}counts{[}ch],counts{[}ch]);}\ccmtend\basefont\njo0{\mast{1}/}\njo0{
}\n\ped \init{9}{}\njo{-9}{model{\ul}get{\ul}freq(\&model,}\njo0{ch,}\njo0{\&cur{\ul}freq,}\njo0{\&cum{\ul}freq,}\njo0{\&total{\ul}freq);}\njo0{
}\n\ped \init{9}{}\njo{-9}{encode{\ul}freq(\&rc,}\njo0{cur{\ul}freq,}\njo0{cum{\ul}freq,}\njo0{total{\ul}freq);}\njo0{
}\n\ped \init{9}{}\njo{-9}{model{\ul}update{\ul}freq(\&model,}\njo0{ch);}\njo0{
}\n\ped \init{9}{}\njo{-9}{{\keywordfont if}(ch}\njo{15}{$>$}\njo{17}{0xff)}\njo{23}{}\njo0{\brl{}
}\n\ped \init{12}{}\njo{-12}{}\cmtinit\njo0{/$\ast$\commentfont~output}\cmt{12}{1}\njo{22}{length,distance}\njo{38}{}\ccmtend\basefont\njo0{\mast{1}/}\njo0{
}\n\ped \init{12}{}\njo{-12}{{\keywordfont const}}\njo{18}{{\keywordfont
struct}}\njo{25}{lz{\ul}extra{\ul}data}\njo0{$\ast$}\njo{40}{extra{\ul}data}\njo{51}{}\njo0{=}\njo{53}{\&extra{\ul}datas{[}j++];}\njo0{
}\n\ped \init{12}{}\njo{-12}{{\keywordfont if}(extra{\ul}data}\njo0{{\mm}$>$extra{\ul}bits)}\njo{39}{}\njo0{\brl{}
}\n\ped \init{15}{}\njo{-15}{encode{\ul}shift(\&rc,}\njo{33}{(freq)1,}\njo{42}{(freq)extra{\ul}data}\njo0{{\mm}$>$extra{\ul}data,}\njo{72}{extra{\ul}data}\njo0{{\mm}$>$extra{\ul}bits);}\njo0{
}\n\ped \init{12}{}\njo{-12}{\brr{}}\njo0{ }\n\ped
\init{15}{}\njo{-15}{encode{\ul}shift(\&rc,}\njo0{(freq)1,}\njo0{(freq)(extra{\ul}data}\njo0{{\mm}$>$distance\&0xff),}\njo{75}{8);}\njo0{
}\n\ped \init{12}{}\njo{-12}{encode{\ul}shift(\&rc,}\njo0{(freq)1,}\njo0{(freq)(extra{\ul}data}\njo0{{\mm}$>$distance\mgt{2}8),}\njo0{8);}\njo0{
}\n\ped \init{9}{}\njo{-9}{\brr{}}\njo0{ }\n\ped
\init{6}{}\njo{-6}{\brr{}}\njo0{ }\n\ped \init{6}{}\njo{-6}{processed}\njo{16}{}\njo0{+=}\njo{19}{blocksize;}\njo0{
}\n\ped \init{6}{}\njo{-6}{{\keywordfont if}(processed}\njo{19}{$>$}\njo{21}{1\mlt{2}19)}\njo{28}{}\njo0{\brl{}
}\n\ped \init{9}{}\njo{-9}{}\cmtinit\njo0{/$\ast$\commentfont~restart}\cmt{9}{1}\njo{20}{encoder}\njo{28}{}\ccmtend\basefont\njo0{\mast{1}/}\njo0{
}\n\ped \init{9}{}\njo{-9}{done{\ul}encoding(\&rc);}\njo0{
}\n\ped \init{9}{}\njo{-9}{start{\ul}encoding(\&rc,}\njo0{0,}\njo0{0);}\njo0{
}\n\ped \init{9}{}\njo{-9}{processed}\njo0{=0;}\njo0{
}\n\ped \init{6}{}\njo{-6}{\brr{}}\njo0{ }\n\ped
\init{6}{}\njo{-6}{fflush(stdout);}\njo0{ }\n\ped \init{6}{}\njo{-6}{}\cmtinit\njo0{/$\ast$fprintf(stderr,\texttt{\char`\"{}}\%d\bs{1}n\texttt{\char`\"{}},model.counts{[}SYMBOLS]);}\ccmtend\basefont\njo0{\mast{1}/}\njo0{
}\n\ped \init{3}{}\njo{-3}{\brr{}}\njo0{ }\n\ped
\init0{}\njo0{ }\n\ped \init{3}{}\njo{-3}{}\cmtinit\njo0{/$\ast$\commentfont~flag}\cmt{3}{1}\njo{11}{absence}\njo{19}{of}\njo{22}{next}\njo{27}{block}\njo{33}{by}\njo{36}{a}\njo{38}{bit}\njo{42}{}\ccmtend\basefont\njo0{\mast{1}/}\njo0{
}\n\ped \init{3}{}\njo{-3}{encode{\ul}freq(\&rc,}\njo0{1,}\njo0{0,}\njo0{2);}\njo0{
}\n\ped \init0{}\njo0{ }\n\ped \init{3}{}\njo{-3}{}\cmtinit\njo0{/$\ast$\commentfont~close}\cmt{3}{1}\njo{12}{the}\njo{16}{encoder}\njo{24}{}\ccmtend\basefont\njo0{\mast{1}/}\njo0{
}\n\ped \init{3}{}\njo{-3}{done{\ul}encoding(\&rc);}\njo0{
}\n\ped \init{3}{}\njo{-3}{model{\ul}done(\&model);}\njo0{
}\n\ped \init{3}{}\njo{-3}{cleanup{\ul}lz{\ul}buffer(\&lz{\ul}buff);}\njo0{
}\n\ped \init0{}\njo0{ }\n\ped \init{3}{}\njo{-3}{fprintf(stderr,}\njo0{\qql}\stringfont\pes{\bs{1}}{0}\njo0{Missed:~}\njo0{\%ld~}\njo0{LZ77~}\njo0{encoding~}\njo0{opportunities\bs{1}n}\njo0{\basefont
\qqr}\basefont\ped\pstart\pstarta\njo0{,}\njo0{errcnt);}\njo0{
}\n\ped \init{3}{}\njo{-3}{fprintf(stderr,}\njo0{\qql}\stringfont\pes{\bs{1}}{0}\njo0{Processed:\%ld~}\njo0{bytes\bs{1}n}\njo0{\basefont
\qqr}\basefont\ped\pstart\pstarta\njo0{,}\njo0{processed);}\njo0{
}\n\ped \init{3}{}\njo{-3}{{\keywordfont return}}\njo{10}{0;}\njo0{
}\n\ped \init0{}\njo0{\brr{}}\njo0{ }\n\ped \par\end{flushleft}

\ifmfiles\def\END{\relax}\else\def\END{\end{document}}\fi \END 
